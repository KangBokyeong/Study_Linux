# [Linux Journey 6] Troubleshooting
## 1. ICMP (Internet Control Message Protocol)
- TCP / IP 프로토콜 제품군의 일부로 업데이트 및 오류 메시지를 보내는데 사용
- 패킷 전달 실패와 같은 네트워크 문제를 디버깅하는데 매우 유용한 프로토콜
- 각 ICMP 메시지에는 유형, 코드 및 체크섬 필드가 있음. 
  - 유형 필드는 ICMP 메시지의 유형
  - 코드는 하위 유형
  - 메시지에 대한 자세한 정보 설명
  - 체크섬은 메시지의 무결성 문제를 감지하는데 사용
- 일반적인 ICMP 유형
  - Type 0: Echo 응답
  - Type 3: 목적지 도달 불가
  - Type 8: Echo 요청
  - Type 11: 시간 초과
- 패킷이 대상에 도착할 수 없으면 Type 3 ICMP 메시지가 생성되고 Type 3에는 목적지에 도달 할 수 없는 이유를 더 자세히 설명하는 16 개의 코드 값이 있음.
  - Code 0: 네트워크에 연결 불가
  - Code 1: 호스트에 연결 불가
  - 등등

- 이 메시지는 일부 네트워크 문제 해결 도구를 사용할 때 더 유용할 수 있음.

## 2. ping
- 패킷이 호스트에 도달 할 수 있는지 여부를 테스트하는데 사용
- ICMP 에코 요청 (유형 8) 패킷을 대상 호스트에 보내고 ICMP 에코 응답 (유형 0)을 기다림.
- 호스트가 요청 패킷을 보내고 대상에서 응답을 받을 때 성공함.
- 예시(ping을 사용하여 www.google.com 에 연결할 수 있는지 확인)
  - ping -c 3 www.google.com 명령  
  ![](https://user-images.githubusercontent.com/44868847/52542222-f5b95980-2de0-11e9-8aab-93a55c900fb3.PNG)  
    - -c 플래그 (count)는 카운트에 도달 한 후 에코 요청 패킷의 전송을 중지하는데 사용
    - 첫 번째 부분은 74.125.239.112 (google.com)에 64 바이트 패킷을 보내고 나머지는 우리에게 여행의 세부 정보를 보여줌.
    - 기본적으로 초당 패킷을 보냄.

### icmp_seq
- 전송된 패킷의 시퀀스 번호를 표시하는데 사용.
- 이 경우 3 개의 패킷을 전송했으며 3 개의 패킷이 다시 생성되었음을 알 수 있음.
- ping을 수행하고 일부 시퀀스 번호가 누락 된 경우 일부 연결 문제가 발생하고 모든 패킷이 통과하는 것은 아님.
- 순서 번호가 잘못된 경우 패킷이 1 초 기본값을 초과하므로 연결 속도가 매우 느릴 수 있음.

### ttl (Time To Live)
- 홉 카운터로 사용되며 홉을 만들 때 카운터를 하나씩 줄이고 홉 카운터가 0에 도달하면 패킷이 사라짐.
- 패킷에 수명을 주기위한 것.

### time  
- 에코 요청 패킷을 보낸 후 에코 응답을받는 데 걸린 왕복 시간

## 3. traceroute
- 패킷이 라우팅되는 방법을 확인하는데 사용
- TTL 값이 증가하는 패킷을 보내면 작동
- 첫 번째 라우터가 패킷을 가져오고 TTL 값을 1 씩 감소시켜 패킷을 삭제
- 라우터가 ICMP Time Exceeded 메시지를 다시 보내줌.
- 다음 패킷은 2의 TTL을 가지므로 첫 번째 라우터를 지나치게 만듬.
- 두 번째 라우터에 도달하면 TTL은 0이며 다른 ICMP 시간 초과 메시지를 반환함.
- 패킷을 보내거나 끊을 때 패킷이 통과하는 라우터의 목록을 작성하여 최종 목적지까지 도달하고 ICMP 에코 응답 메시지를 가져옴. 
- 예시
  - traceroute google.com 명령 사용  
  ![](https://user-images.githubusercontent.com/44868847/52542287-8f810680-2de1-11e9-9ccf-943a71ae23a6.PNG)  
    - 각 회선은 저와 저의 목표 사이에있는 라우터 또는 기계
    - 대상의 이름과 IP 주소를 보여 주며 마지막 세 열은 해당 라우터에 도착할 패킷의 왕복 시간에 해당.
    -  기본적으로 경로를 따라 3 개의 패킷을 보냄.
    
## 4. netstat
## 5. Packet Analysis
