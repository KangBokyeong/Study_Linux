# [Linux Journey 4] Routing
## 1. What is a router?
- 네트워크상의 머신이 다른 네트워크는 물론 다른 네트워크와도 통신 할 수 있게 함.
- 일반적인 라우터에는 LAN 포트가있어 컴퓨터를 동일한 LAN에 연결할 수 있으며 인터넷 업 링크 포트를 통해 인터넷에 연결되며 때로는이 포트가 WAN으로 표시되는 것을 볼 수 있음.
  - 왜? -> 본질적으로 당신을 더 넓은 네트워크에 연결하기 때문
- 네트워크 패킷의 위치와 경로 결정
- 패킷을 여러 네트워크 사이에 라우팅하여 소스 호스트에서 대상 호스트로 가져옴.

### 라우터는 어떻게 작동하는지?
- 패킷을 라우팅 할 때 네트워크 A에 도착하는 것과 같은 주소 "경로"를 사용하여 패킷 B를 네트워크 B로 전송
- 경로가 설정되어 있지 않으면 패킷에 사용할 기본 경로가 있음.

### Hops
- 패킷이 출발지에서 목적지까지 이동해야하는 거리를 대략 측정하는 방법
- 패킷이 네트워크를 통해 이동함에 따라 패킷이 홉 (hop)으로 이동
- 두 개의 라우터가 호스트 A와 호스트 B를 연결한다고 가정하면 호스트 A와 호스트 B 사이에 두 개의 홉이 있다고 가정
  - 각 홉은 통과해야하는 라우터와 같은 중간 장치

### SWITCHING, ROUTING 및 FLOODING 간의 기본적인 차이점은 이해하고 있는지?
- 패킷 SWITCHING: 기본적으로 대상 장치로 데이터를 수신, 처리 및 전달하는 것
- ROUTING: 라우팅 테이블을 생성하는 프로세스. 더 나은 스위칭 수행 가능
- FLOODING: 라우팅 전에 사용됨.
- 라우터가 모든 수신 패킷보다 패킷을 전송하는 방법을 모르는 경우 수신 패킷을 제외한 모든 발신 링크를 통해 전송됨.

## 2. Routing Table
- 라우팅 테이블을 보려면 sudo route -n이라는 명령 사용
- 명령 사용 시, 아래와 같은 결과 출력
  ![](https://user-images.githubusercontent.com/44868847/52488637-98b47c80-2c03-11e9-8095-23f133c1eab7.PNG)

### Destination
- 첫 번째 필드에 192.168.224.0의 대상 IP 주소가 있음.
- 이 네트워크에 연결하려고하는 모든 패킷은 이더넷 케이블 (eth0)을 통해 나옴.
- 자기 자신이 192.168.224.5이고 192.168.224.7로 가길 원한다면 네트워크 인터페이스 eth0을 직접 사용하면 됨.
- 주소가 0.0.0.0 임을 알 수 있음.
- 이는 주소가 지정되지 않았거나 알 수 없음을 의미함.
- 예를 들어, IP 주소 151.123.43.6으로 패킷을 보내고 싶다면 우리의 라우팅 테이블은 그것이 어디로 가는지 알지 못하기 때문에 0.0.0.0으로 표시하고 패킷을 게이트웨이로 라우팅

### Gateway
- 동일한 네트워크에 있지 않은 패킷을 보내면 이 게이트웨이 주소로 전송
- 다른 네트워크에 대한 게이트웨이로 적절하게 명명됨.

### Genmask
- 어떤 IP 주소가 어떤 목적지와 일치하는지 알아내는데 사용되는 서브넷 마스크 

### Flags
- UG(Network is Up and is a Gateway): 네트워크가 작동하고 게이트웨이.
- U(Network is Up): 네트워크가 작동 중.

### Iface
- 우리의 패킷이 나갈 인터페이스.
- eth0: 보통 시스템에서 첫 번째 이더넷 장치를 의미.

## 3. Path of a Packet
### 로컬 네트워크 내에서 패킷의 이동 방법
1. 먼저 로컬 컴퓨터는 대상 IP 주소를 비교하여 해당 서브넷 마스크를보고 동일한 서브넷에 있는지 확인
2. 패킷을 보낼 때 원본 MAC 주소, 대상 MAC 주소, 원본 IP 주소 및 대상 IP 주소가 필요함. 이 시점에서 대상 MAC 주소를 알 수 없음.
3. 대상 호스트에 도달하기 위해 ARP를 사용하여 로컬 네트워크에서 요청을 브로드 캐스트하여 대상 호스트의 MAC 주소를 찾음.
4. 이제 패킷을 성공적으로 보낼 수 있음.

### 패킷이 네트워크 외부로의 이동 방법
1. 먼저 로컬 컴퓨터는 네트워크 외부에 있으므로 대상 호스트의 MAC 주소를 볼 수 없으므로 대상 IP 주소 비교. ARP 요청은 로컬로 연결된 호스트에 대한 브로드 캐스트이므로 ARP를 사용 불가.
2. 패킷은 이제 라우팅 테이블을보고 대상 IP 주소를 알지 못하기 때문에 기본 게이트웨이 (다른 라우터)로 보냄. 패킷에는 소스 IP, 대상 IP 및 원본 MAC이 포함되어 있지만 대상 MAC은 없음. *"MAC 주소는 동일한 네트워크를 통해서만 도달한다는 것을 기억"* 기본 게이트웨이의 MAC 주소를 가져 오는 ARP 요청을 보냄.
3. 라우터는 패킷을 보고 대상 MAC 주소를 확인하지만 최종 대상 IP 주소는 아니므로 패킷을 대상으로 이동하는데 도움이되는 다른 IP 주소로 패킷을 전달하기 위해 라우팅 테이블을 계속 살펴 봄. 패킷이 이동할 때마다 이전 원본 및 대상 MAC 주소를 제거하고 패킷을 새 원본 및 대상 MAC 주소로 업데이트 함.
4. 패킷이 동일한 네트워크로 전달되면 ARP를 사용하여 최종 대상 MAC 주소를 찾음.
5. 이 과정에서 패킷은 소스 또는 대상 IP 주소를 변경하지 않음.


## 4. Routing Protocols
- 시스템이 네트워크 변경 사항에 적응하도록 돕기 위해 사용
- 다른 경로를 학습하고, 라우팅 테이블에서 라우팅 프로토콜을 구축한 다음 패킷을 해당 경로로 라우팅
- 두 가지 기본 라우팅 프로토콜 유형
  - distance vector protocols: 거리 벡터 프로토콜
  - link state protocols: 링크 상태 프로토콜

### Convergence: 수렴
- 라우팅 프로토콜을 사용할 때 라우터는 다른 라우터와 통신하여 네트워크에 대한 정보를 수집하고 교환함.
- 네트워크가 어떻게 보일 것인가에 동의하면 모든 라우팅 테이블이 네트워크의 완전한 토폴로지를 매핑하여 "수렴"함.
- 네트워크 토폴로지에서 무언가가 발생하면 모든 라우터가 이러한 변화를 인식 할 때까지 수렵이 일시적으로 중단

## 5. Distance Vector Protocols
- 패킷이 네트워크를 통해 걸리는 홉 수를 사용하여 다른 네트워크의 경로 결정
  - 네트워크 A가 3 홉 떨어져 네트워크 B가 네트워크 A의 옆에 있다면, 우리는 4 홉 거리에 있어야한다고 가정
  - 거리 벡터 프로토콜에서 다음 경로는 최소 홉 수의 경로
- 소규모 네트워크에 적합
  - 네트워크가 확장되기 시작하면 정기적으로 전체 라우팅 테이블을 모든 라우터로 전송하기 때문에 라우터가 수렴하는 데 시간이 오래 걸림.
  - 홉이 가까운 경로를 선택하지만 항상 가장 효율적인 경로를 선택하지는 않음.
- RIP (Routing Information Protocol)
  - 일반적인 거리 벡터 프로토콜 중 하나.
  - 30 초마다 네트워크의 모든 라우터에 라우팅 테이블을 브로드 캐스트 함.
  - 대규모 네트워크의 경우, RIP가 홉 수를 15 개로 제한하기 때문에이 작업을 수행하는 데 상당한 주력이 요구될 수 있음.

## 6. Link State Protocols
- 대용량 네트워크에 적합
  - 거리 벡터 프로토콜보다 복잡하지만 큰 수확량은 수렴 속도가 빠름.
    - 왜? -> 주기적으로 전체 라우팅 테이블을 전송하는 대신 인접 라우터로만 업데이트를 전송하기 때문임.
  - 다른 알고리즘을 사용하여 최단 경로를 먼저 계산하고 네트워크 형태를 그래프 형태로 구성하여 어떤 라우터가 다른 라우터에 연결되어 있는지를 보여줌.
- OSPF (Open Shortest Path First)
  - 일반적인 링크 상태 프로토콜 중 하나
  - 네트워크 변경이 있을 경우에만 라우팅 테이블 업데이트
  - 홉 한계 없음

## 7. Border Gateway Protocol
- 기본적으로 인터넷이 작동하는 방식.
- 자율적인 시스템 간의 라우팅 정보를 수집하고 교환하는데 사용
